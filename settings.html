<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>الإعدادات - مترجم فوري</title>
    <link rel="icon" href="logo-new.svg" type="image/svg+xml">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?display=swap&family=Inter:wght@400;500;700;900&family=Noto+Sans:wght@400;500;700;900" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <style type="text/tailwindcss">
        :root {
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --secondary-text: #617589;
            --background-color: #f0f2f4;
            --surface-color: #ffffff;
        }
        body {
            font-family: 'Inter', 'Noto Sans', sans-serif;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            min-height: 100vh;
        }
        .toggle-switch {
            position: relative;
            display: inline-flex;
            height: 2rem;
            width: 3.5rem;
            cursor: pointer;
            align-items: center;
            border-radius: 9999px;
            border: none;
            background-color: rgb(229 231 235);
            transition-property: color, background-color, border-color, text-decoration-color, fill, stroke;
            transition-duration: 300ms;
            transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
        }
        .toggle-switch:has(:checked) {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        }
        .toggle-switch-handle {
            display: inline-block;
            height: 1.5rem;
            width: 1.5rem;
            transform: translateX(0);
            border-radius: 9999px;
            background-color: white;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            transition-property: transform;
            transition-duration: 300ms;
            transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
        }
        input:checked + .toggle-switch-handle {
            transform: translateX(1.5rem);
        }
        .settings-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        .section-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(5px);
            border-radius: 15px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05);
        }
        .primary-button {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        .primary-button:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        
        /* Dark theme styles */
        .dark-theme {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        }
        
        .dark-theme .settings-container {
            background: rgba(30, 30, 30, 0.95);
        }
        
        .dark-theme .section-card {
            background: rgba(40, 40, 40, 0.9);
        }
        
        .dark-theme h1,
        .dark-theme h2,
        .dark-theme p {
            color: #ffffff !important;
        }
        
        .dark-theme .text-gray-500 {
            color: #9ca3af !important;
        }
        
        .dark-theme .text-gray-400 {
            color: #6b7280 !important;
        }
        
        .dark-theme .bg-gray-100 {
            background-color: #374151 !important;
        }
        
        .dark-theme .bg-gray-50 {
            background-color: #4b5563 !important;
        }
        
        .dark-theme .border-gray-100 {
            border-color: #4b5563 !important;
        }
        
        .dark-theme .hover\:bg-gray-100:hover {
            background-color: #6b7280 !important;
        }
    </style>
</head>
<body>
    <div class="relative flex size-full min-h-screen flex-col justify-between">
        <div class="flex-grow p-4">
            <div class="settings-container max-w-md mx-auto">
                <!-- Header -->
                <header class="sticky top-0 z-10 bg-white/80 backdrop-blur-md rounded-t-20">
                    <div class="flex items-center px-4 py-3">
                        <button onclick="goBack()" class="text-[#111418] flex size-10 shrink-0 items-center justify-center rounded-full hover:bg-gray-100 transition-colors tooltip" data-tooltip="العودة للصفحة السابقة">
                            <span class="material-symbols-outlined">arrow_back_ios_new</span>
                        </button>
                        <div class="flex items-center justify-center gap-2 flex-1 pr-10">
                            <img src="logo-new.svg" alt="Logo" style="width: 80px; height: 80px;">
                            <h1 class="text-[#111418] text-xl font-bold leading-tight tracking-tight">الإعدادات</h1>
                        </div>
                    </div>
                </header>

                <!-- Main Content -->
                <main class="px-4 py-6 space-y-6">
                    <!-- General Section -->
                    <section>
                        <h2 class="text-sm font-bold text-gray-500 uppercase tracking-wider mb-2 px-4">عام</h2>
                        <div class="section-card">
                            <div class="flex items-center gap-4 p-4">
                                <div class="primary-button">
                                    <span class="material-symbols-outlined">language</span>
                                </div>
                                <div class="flex flex-col flex-grow">
                                    <p class="text-[#111418] text-base font-medium">اللغات</p>
                                    <p class="text-[var(--secondary-text)] text-sm">إدارة حزم اللغات</p>
                                </div>
                                <span class="material-symbols-outlined text-gray-400">arrow_forward_ios</span>
                            </div>
                            <hr class="border-gray-100 mx-4">
                            <div class="flex items-center gap-4 p-4 cursor-pointer" onclick="toggleLanguageMenu()">
                                <div class="text-gray-600 flex items-center justify-center rounded-full bg-gray-100 shrink-0 size-10">
                                    <span class="material-symbols-outlined">translate</span>
                                </div>
                                <div class="flex flex-col flex-grow">
                                    <p class="text-[#111418] text-base font-medium">لغة التطبيق</p>
                                    <p class="text-[var(--secondary-text)] text-sm">اختر لغتك المفضلة</p>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span id="current-language" class="text-[#111418] text-sm font-medium">العربية</span>
                                    <span class="material-symbols-outlined text-gray-400">expand_more</span>
                                </div>
                            </div>
                            <div id="language-menu" class="hidden px-4 pb-4">
                                <div class="bg-gray-50 rounded-lg p-2 space-y-1">
                                    <div class="flex items-center gap-3 p-2 rounded cursor-pointer hover:bg-gray-100" onclick="selectLanguage('ar')">
                                        <span class="text-[#111418] text-sm">العربية</span>
                                    </div>
                                    <div class="flex items-center gap-3 p-2 rounded cursor-pointer hover:bg-gray-100" onclick="selectLanguage('en')">
                                        <span class="text-[#111418] text-sm">English</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>



                    <!-- App Settings Section -->
                    <section>
                        <h2 class="text-sm font-bold text-gray-500 uppercase tracking-wider mb-2 px-4">إعدادات التطبيق</h2>
                        <div class="section-card">
                            <div class="flex items-center gap-4 p-4">
                                <div class="text-gray-600 flex items-center justify-center rounded-full bg-gray-100 shrink-0 size-10">
                                    <span class="material-symbols-outlined">palette</span>
                                </div>
                                <div class="flex flex-col flex-grow">
                                    <p class="text-[#111418] text-base font-medium">المظهر</p>
                                    <p class="text-[var(--secondary-text)] text-sm">فاتح / داكن</p>
                                </div>
                                <div class="flex gap-2">
                                    <button data-theme="light" class="flex items-center justify-center size-8 rounded-full text-gray-500 tooltip" data-tooltip="تفعيل الوضع النهاري" onclick="switchTheme('light')">
                                        <span class="material-symbols-outlined">light_mode</span>
                                    </button>
                                    <button data-theme="dark" class="flex items-center justify-center size-8 rounded-full text-gray-500 tooltip" data-tooltip="تفعيل الوضع الليلي" onclick="switchTheme('dark')">
                                        <span class="material-symbols-outlined">dark_mode</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Audio & Translation Settings -->
                    <section>
                        <h2 class="text-sm font-bold text-gray-500 uppercase tracking-wider mb-2 px-4">الصوت والترجمة</h2>
                        <div class="section-card">
                            <div class="flex items-center gap-4 p-4">
                                <div class="text-gray-600 flex items-center justify-center rounded-full bg-gray-100 shrink-0 size-10">
                                    <span class="material-symbols-outlined">volume_up</span>
                                </div>
                                <div class="flex flex-col flex-grow">
                                    <p class="text-[#111418] text-base font-medium">مستوى الصوت</p>
                                    <div class="flex items-center gap-3 mt-2">
                                        <input type="range" id="volume-slider" min="0" max="100" value="70" class="flex-grow">
                                        <span id="volume-value" class="text-sm text-gray-600 min-w-[3rem]">70%</span>
                                    </div>
                                </div>
                            </div>

                            <hr class="border-gray-100 mx-4">
                            <div class="flex items-center gap-4 p-4 cursor-pointer" onclick="toggleTranslationSettings()">
                                <div class="text-gray-600 flex items-center justify-center rounded-full bg-gray-100 shrink-0 size-10">
                                    <span class="material-symbols-outlined">settings</span>
                                </div>
                                <div class="flex flex-col flex-grow">
                                    <p class="text-[#111418] text-base font-medium">إعدادات الترجمة</p>
                                    <p class="text-[var(--secondary-text)] text-sm">محرك الترجمة والجودة</p>
                                </div>
                                <span class="material-symbols-outlined text-gray-400">expand_more</span>
                            </div>
                            <div id="translation-settings" class="hidden px-4 pb-4 space-y-3">
                                <div class="bg-gray-50 rounded-lg p-3">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">محرك الترجمة</label>
                                    <select id="translation-engine" class="w-full p-2 border border-gray-300 rounded-md">
                                        <option value="google">Google Translate</option>
                                        <option value="microsoft">Microsoft Translator</option>
                                        <option value="deepl">DeepL</option>
                                    </select>
                                </div>
                                <div class="bg-gray-50 rounded-lg p-3">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">جودة الترجمة</label>
                                    <select id="translation-quality" class="w-full p-2 border border-gray-300 rounded-md">
                                        <option value="fast">سريع</option>
                                        <option value="standard">عادي</option>
                                        <option value="high">عالي الجودة</option>
                                    </select>
                                </div>
                                <div class="flex items-center justify-between bg-gray-50 rounded-lg p-3">
                                    <span class="text-sm font-medium text-gray-700">حفظ تاريخ الترجمة</span>
                                    <label class="toggle-switch" id="save-history-toggle">
                                        <input class="sr-only" type="checkbox" id="save-history" checked>
                                        <span class="toggle-switch-handle"></span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </section>



                    <!-- Support and Feedback Section -->
                    <section>
                        <h2 class="text-sm font-bold text-gray-500 uppercase tracking-wider mb-2 px-4">الدعم</h2>
                        <div class="section-card">
                            <div class="flex items-center gap-4 p-4 cursor-pointer" onclick="sendFeedback()">
                                <div class="text-gray-600 flex items-center justify-center rounded-full bg-gray-100 shrink-0 size-10">
                                    <span class="material-symbols-outlined">feedback</span>
                                </div>
                                <div class="flex flex-col flex-grow">
                                    <p class="text-[#111418] text-base font-medium">إرسال ملاحظات</p>
                                    <p class="text-[var(--secondary-text)] text-sm">شاركنا رأيك لتحسين التطبيق</p>
                                </div>
                                <label class="toggle-switch">
                                    <input class="sr-only" type="checkbox" id="auto-feedback" checked>
                                    <span class="toggle-switch-handle"></span>
                                </label>
                            </div>
                            <hr class="border-gray-100 mx-4">
                            <div class="flex items-center gap-4 p-4 cursor-pointer" onclick="getHelp()">
                                <div class="text-gray-600 flex items-center justify-center rounded-full bg-gray-100 shrink-0 size-10">
                                    <span class="material-symbols-outlined">help</span>
                                </div>
                                <div class="flex flex-col flex-grow">
                                    <p class="text-[#111418] text-base font-medium">المساعدة التلقائية</p>
                                    <p class="text-[var(--secondary-text)] text-sm">احصل على مساعدة فورية وذكية</p>
                                </div>
                                <label class="toggle-switch">
                                    <input class="sr-only" type="checkbox" id="auto-help" checked>
                                    <span class="toggle-switch-handle"></span>
                                </label>
                            </div>
                            <hr class="border-gray-100 mx-4">
                            <div class="flex items-center gap-4 p-4 cursor-pointer" onclick="showPrivacyPolicy()">
                                <div class="text-gray-600 flex items-center justify-center rounded-full bg-gray-100 shrink-0 size-10">
                                    <span class="material-symbols-outlined">privacy_tip</span>
                                </div>
                                <div class="flex flex-col flex-grow">
                                    <p class="text-[#111418] text-base font-medium">سياسة الخصوصية</p>
                                    <p class="text-[var(--secondary-text)] text-sm">اطلع على كيفية حماية بياناتك</p>
                                </div>
                                <span class="material-symbols-outlined text-gray-400">arrow_forward_ios</span>
                            </div>
                            <hr class="border-gray-100 mx-4">
                            <div class="flex items-center gap-4 p-4 cursor-pointer" onclick="showTermsOfService()">
                                <div class="text-gray-600 flex items-center justify-center rounded-full bg-gray-100 shrink-0 size-10">
                                    <span class="material-symbols-outlined">description</span>
                                </div>
                                <div class="flex flex-col flex-grow">
                                    <p class="text-[#111418] text-base font-medium">شروط الاستخدام</p>
                                    <p class="text-[var(--secondary-text)] text-sm">اقرأ شروط وأحكام الاستخدام</p>
                                </div>
                                <span class="material-symbols-outlined text-gray-400">arrow_forward_ios</span>
                            </div>
                        </div>
                    </section>
                </main>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <nav class="bg-white/90 backdrop-blur-md border-t border-gray-200 px-4 py-2">
            <div class="flex justify-around items-center max-w-md mx-auto">
                <a href="translate.html" class="flex flex-col items-center p-2 text-gray-500 hover:text-blue-600 transition-colors">
                    <span class="material-symbols-outlined text-2xl">translate</span>
                    <span class="text-xs mt-1">ترجمة</span>
                </a>
                <a href="index.html" class="flex flex-col items-center p-2 text-gray-500 hover:text-blue-600 transition-colors">
                    <span class="material-symbols-outlined text-2xl">home</span>
                    <span class="text-xs mt-1">الرئيسية</span>
                </a>
                <a href="settings.html" class="flex flex-col items-center p-2 text-blue-600">
                    <span class="material-symbols-outlined text-2xl">settings</span>
                    <span class="text-xs mt-1">الإعدادات</span>
                </a>
            </div>
        </nav>
    </div>

    <script>
        // Initialize theme and language from localStorage
        let currentTheme = localStorage.getItem('theme') || 'light';
        let currentLanguage = localStorage.getItem('language') || 'ar';

        function goBack() {
            if (document.referrer) {
                window.history.back();
            } else {
                window.location.href = 'index.html';
            }
        }

        // Language switching functionality
        function switchLanguage(lang) {
            currentLanguage = lang;
            localStorage.setItem('language', lang);
            
            if (lang === 'en') {
                document.documentElement.lang = 'en';
                document.documentElement.dir = 'ltr';
                updateLanguageText('en');
            } else {
                document.documentElement.lang = 'ar';
                document.documentElement.dir = 'rtl';
                updateLanguageText('ar');
            }
        }

        function updateLanguageText(lang) {
            const translations = {
                ar: {
                    title: 'الإعدادات - مترجم فوري',
                    settings: 'الإعدادات',
                    general: 'عام',
                    languages: 'اللغات',
                    languageDesc: 'إدارة حزم اللغات',
                    appLanguage: 'لغة التطبيق',
                    appLanguageDesc: 'اختر لغتك المفضلة',
                    arabic: 'العربية',
                    account: 'الحساب',
                    login: 'تسجيل الدخول',
                    loginDesc: 'سجل دخولك أو أنشئ حساب جديد',
                    appSettings: 'إعدادات التطبيق',
                    appearance: 'المظهر',
                    appearanceDesc: 'فاتح / داكن',
                    notifications: 'الإشعارات',
                    dailyTips: 'نصائح يومية',
                    dailyTipsDesc: 'احصل على نصائح ترجمة يومية',
                    updates: 'التحديثات',
                    updatesDesc: 'احصل على إشعارات حول الميزات الجديدة',
                    support: 'الدعم والملاحظات',
                    feedback: 'إرسال ملاحظات',
                    help: 'المساعدة',
                    translate: 'ترجمة',
                    home: 'الرئيسية'
                },
                en: {
                    title: 'Settings - Voice Translator',
                    settings: 'Settings',
                    general: 'General',
                    languages: 'Languages',
                    languageDesc: 'Manage language packs',
                    appLanguage: 'App Language',
                    appLanguageDesc: 'Choose your preferred language',
                    arabic: 'English',
                    account: 'Account',
                    login: 'Sign In',
                    loginDesc: 'Sign in or create a new account',
                    appSettings: 'App Settings',
                    appearance: 'Appearance',
                    appearanceDesc: 'Light / Dark',
                    notifications: 'Notifications',
                    dailyTips: 'Daily Tips',
                    dailyTipsDesc: 'Get daily translation tips',
                    updates: 'Updates',
                    updatesDesc: 'Get notifications about new features',
                    support: 'Support & Feedback',
                    feedback: 'Send Feedback',
                    help: 'Help',
                    translate: 'Translate',
                    home: 'Home'
                }
            };

            const t = translations[lang];
            document.title = t.title;
            document.querySelector('h1').textContent = t.settings;
        }

        // Theme switching functionality
        function switchTheme(theme) {
            currentTheme = theme;
            localStorage.setItem('theme', theme);
            
            if (theme === 'dark') {
                document.body.classList.add('dark-theme');
                updateThemeButtons('dark');
            } else {
                document.body.classList.remove('dark-theme');
                updateThemeButtons('light');
            }
        }

        function updateThemeButtons(activeTheme) {
            const lightBtn = document.querySelector('[data-theme="light"]');
            const darkBtn = document.querySelector('[data-theme="dark"]');
            
            // Reset all buttons
            [lightBtn, darkBtn].forEach(btn => {
                if (btn) {
                    btn.className = 'flex items-center justify-center size-8 rounded-full text-gray-500';
                }
            });
            
            // Set active button
            const activeBtn = activeTheme === 'light' ? lightBtn : darkBtn;
            if (activeBtn) {
                activeBtn.className = 'primary-button';
            }
        }

        // Language menu functionality
        function toggleLanguageMenu() {
            const menu = document.getElementById('language-menu');
            menu.classList.toggle('hidden');
        }

        function selectLanguage(lang) {
            const currentLangElement = document.getElementById('current-language');
            const menu = document.getElementById('language-menu');
            
            if (lang === 'ar') {
                currentLangElement.textContent = 'العربية';
            } else {
                currentLangElement.textContent = 'English';
            }
            
            switchLanguage(lang);
            menu.classList.add('hidden');
        }

        // Translation settings functionality
        function toggleTranslationSettings() {
            const settings = document.getElementById('translation-settings');
            settings.classList.toggle('hidden');
        }

        // Volume control functionality
        function initializeVolumeControl() {
            const volumeSlider = document.getElementById('volume-slider');
            const volumeValue = document.getElementById('volume-value');
            
            if (volumeSlider && volumeValue) {
                // Load saved volume
                const savedVolume = localStorage.getItem('volume') || '70';
                volumeSlider.value = savedVolume;
                volumeValue.textContent = savedVolume + '%';
                
                volumeSlider.addEventListener('input', function() {
                    const volume = this.value;
                    volumeValue.textContent = volume + '%';
                    localStorage.setItem('volume', volume);
                    
                    // Apply volume to audio elements if any
                    const audioElements = document.querySelectorAll('audio');
                    audioElements.forEach(audio => {
                        audio.volume = volume / 100;
                    });
                });
            }
        }

        // Translation engine settings
        function initializeTranslationSettings() {
            const engineSelect = document.getElementById('translation-engine');
            const qualitySelect = document.getElementById('translation-quality');
            const saveHistoryCheckbox = document.getElementById('save-history');
            
            if (engineSelect) {
                // Load saved engine
                const savedEngine = localStorage.getItem('translation-engine') || 'google';
                engineSelect.value = savedEngine;
                
                engineSelect.addEventListener('change', function() {
                    localStorage.setItem('translation-engine', this.value);
                    console.log('Translation engine changed to:', this.value);
                });
            }
            
            if (qualitySelect) {
                // Load saved quality
                const savedQuality = localStorage.getItem('translation-quality') || 'standard';
                qualitySelect.value = savedQuality;
                
                qualitySelect.addEventListener('change', function() {
                    localStorage.setItem('translation-quality', this.value);
                    console.log('Translation quality changed to:', this.value);
                });
            }
            
            if (saveHistoryCheckbox) {
                // Load saved history setting
                const savedHistory = localStorage.getItem('save-history');
                if (savedHistory !== null) {
                    saveHistoryCheckbox.checked = savedHistory === 'true';
                }
                
                saveHistoryCheckbox.addEventListener('change', function() {
                    localStorage.setItem('save-history', this.checked);
                    console.log('Save history:', this.checked ? 'enabled' : 'disabled');
                });
            }
        }

        // Account management functions removed as account section was deleted
        
        function showNotification(message) {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = 'fixed top-4 right-4 bg-blue-500 text-white px-4 py-2 rounded-lg shadow-lg z-50 transition-all duration-300';
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            // Remove notification after 3 seconds
            setTimeout(() => {
                notification.style.opacity = '0';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }
        
        // Support and Feedback Functions
        function sendFeedback() {
             const autoFeedback = document.getElementById('auto-feedback').checked;
             if (autoFeedback) {
                 // Auto feedback collection
                 const feedbackData = {
                     timestamp: new Date().toISOString(),
                     userAgent: navigator.userAgent,
                     language: currentLanguage,
                     theme: currentTheme,
                     volume: localStorage.getItem('volume') || '70',
                     translationEngine: localStorage.getItem('translation-engine') || 'google',
                     translationQuality: localStorage.getItem('translation-quality') || 'standard'
                 };
                 
                 // Store feedback data locally
                 let feedbackHistory = JSON.parse(localStorage.getItem('feedbackHistory') || '[]');
                 feedbackHistory.push(feedbackData);
                 localStorage.setItem('feedbackHistory', JSON.stringify(feedbackHistory));
                 
                 showNotification('تم إرسال الملاحظات تلقائياً - شكراً لك!');
             } else {
                 // Manual feedback using custom dialog
                 showFeedbackDialog();
             }
         }
        
        function getHelp() {
             const autoHelp = document.getElementById('auto-help').checked;
             if (autoHelp) {
                 // Smart auto help based on user behavior
                 const helpTips = [
                     'نصيحة: يمكنك تغيير محرك الترجمة من إعدادات الصوت والترجمة',
                     'نصيحة: استخدم الوضع الداكن لتوفير البطارية في الليل',
                     'نصيحة: يمكنك ضبط مستوى الصوت حسب البيئة المحيطة',
                     'نصيحة: جرب محركات ترجمة مختلفة للحصول على أفضل النتائج',
                     'نصيحة: احفظ تاريخ الترجمة للرجوع إليه لاحقاً'
                 ];
                 
                 const randomTip = helpTips[Math.floor(Math.random() * helpTips.length)];
                 showNotification(randomTip);
                 
                 // Store help interaction
                 let helpHistory = JSON.parse(localStorage.getItem('helpHistory') || '[]');
                 helpHistory.push({
                     timestamp: new Date().toISOString(),
                     tip: randomTip,
                     auto: true
                 });
                 localStorage.setItem('helpHistory', JSON.stringify(helpHistory));
             } else {
                 // Manual help using custom dialog
                 showHelpDialog();
             }
         }
        
        function showPrivacyPolicy() {
            const privacyContent = `
                سياسة الخصوصية - مترجم فوري\n\n
                نحن نحترم خصوصيتك ونلتزم بحماية بياناتك الشخصية.\n\n
                البيانات التي نجمعها:\n
                • إعدادات التطبيق (اللغة، المظهر، مستوى الصوت)\n
                • تاريخ الترجمات (إذا اخترت حفظه)\n
                • ملاحظاتك وتقييماتك\n\n
                كيف نستخدم بياناتك:\n
                • تحسين تجربة الاستخدام\n
                • تطوير ميزات جديدة\n
                • تقديم دعم فني أفضل\n\n
                حماية البيانات:\n
                • جميع البيانات محفوظة محلياً على جهازك\n
                • لا نشارك بياناتك مع أطراف ثالثة\n
                • يمكنك حذف بياناتك في أي وقت
            `;
            
            alert(privacyContent);
        }
        
        function showTermsOfService() {
             const termsContent = `
                 شروط الاستخدام - مترجم فوري\n\n
                 بإستخدام هذا التطبيق، فإنك توافق على:\n\n
                 1. الاستخدام المسؤول:\n
                 • استخدام التطبيق للأغراض القانونية فقط\n
                 • عدم إساءة استخدام الخدمة\n\n
                 2. دقة الترجمة:\n
                 • الترجمات قد لا تكون دقيقة 100%\n
                 • ننصح بمراجعة الترجمات المهمة\n\n
                 3. التحديثات:\n
                 • قد نقوم بتحديث الشروط من وقت لآخر\n
                 • سيتم إشعارك بأي تغييرات مهمة\n\n
                 4. المسؤولية:\n
                 • التطبيق مقدم 'كما هو'\n
                 • نحن غير مسؤولين عن أي أضرار قد تنتج عن الاستخدام
             `;
             
             alert(termsContent);
         }
         
         // Custom dialog functions
         function showFeedbackDialog() {
             const dialog = createCustomDialog(
                 'إرسال ملاحظات',
                 '<textarea id="feedback-input" placeholder="شاركنا رأيك لتحسين التطبيق..." style="width: 100%; height: 100px; padding: 10px; border: 1px solid #ddd; border-radius: 8px; resize: vertical;"></textarea>',
                 [
                     { text: 'إلغاء', action: 'cancel' },
                     { text: 'إرسال', action: 'submit' }
                 ]
             );
             
             dialog.onsubmit = function() {
                 const feedback = document.getElementById('feedback-input').value.trim();
                 if (feedback) {
                     const feedbackData = {
                         timestamp: new Date().toISOString(),
                         feedback: feedback,
                         language: currentLanguage,
                         theme: currentTheme
                     };
                     
                     let feedbackHistory = JSON.parse(localStorage.getItem('feedbackHistory') || '[]');
                     feedbackHistory.push(feedbackData);
                     localStorage.setItem('feedbackHistory', JSON.stringify(feedbackHistory));
                     
                     showNotification('شكراً لك! تم إرسال ملاحظاتك بنجاح');
                     closeCustomDialog();
                 } else {
                     showNotification('يرجى كتابة ملاحظاتك أولاً');
                 }
             };
         }
         
         function showHelpDialog() {
             const helpOptions = [
                 { id: '1', text: 'كيفية استخدام الترجمة الفورية' },
                 { id: '2', text: 'تغيير إعدادات الصوت' },
                 { id: '3', text: 'اختيار محرك الترجمة المناسب' },
                 { id: '4', text: 'استخدام الوضع الداكن' },
                 { id: '5', text: 'حفظ واستعادة الترجمات' }
             ];
             
             const optionsHtml = helpOptions.map(option => 
                 `<div class="help-option" onclick="selectHelpOption('${option.id}')" style="padding: 10px; margin: 5px 0; background: #f5f5f5; border-radius: 8px; cursor: pointer; transition: background 0.2s;">${option.text}</div>`
             ).join('');
             
             const dialog = createCustomDialog(
                 'اختر موضوع المساعدة',
                 `<div id="help-options">${optionsHtml}</div>`,
                 [
                     { text: 'إلغاء', action: 'cancel' }
                 ]
             );
         }
         
         function selectHelpOption(optionId) {
             const helpContent = {
                 '1': 'للاستخدام: اضغط على زر الميكروفون وتحدث، ستظهر الترجمة فوراً',
                 '2': 'يمكنك ضبط مستوى الصوت من شريط التمرير في إعدادات الصوت والترجمة',
                 '3': 'جرب محركات مختلفة (Google, Microsoft, Amazon) للحصول على أفضل النتائج',
                 '4': 'الوضع الداكن يوفر البطارية ويريح العينين في الإضاءة المنخفضة',
                 '5': 'فعّل حفظ تاريخ الترجمة للرجوع إلى ترجماتك السابقة'
             };
             
             showNotification(helpContent[optionId] || 'سيتم إضافة المزيد من المساعدة قريباً');
             closeCustomDialog();
         }
         
         function createCustomDialog(title, content, buttons) {
             // Remove existing dialog if any
             closeCustomDialog();
             
             const overlay = document.createElement('div');
             overlay.id = 'custom-dialog-overlay';
             overlay.style.cssText = `
                 position: fixed;
                 top: 0;
                 left: 0;
                 width: 100%;
                 height: 100%;
                 background: rgba(0, 0, 0, 0.5);
                 display: flex;
                 justify-content: center;
                 align-items: center;
                 z-index: 1000;
             `;
             
             const dialog = document.createElement('div');
             dialog.style.cssText = `
                 background: white;
                 border-radius: 12px;
                 padding: 20px;
                 max-width: 400px;
                 width: 90%;
                 box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
             `;
             
             const titleEl = document.createElement('h3');
             titleEl.textContent = title;
             titleEl.style.cssText = 'margin: 0 0 15px 0; text-align: center; color: #333;';
             
             const contentEl = document.createElement('div');
             contentEl.innerHTML = content;
             contentEl.style.cssText = 'margin-bottom: 20px;';
             
             const buttonsEl = document.createElement('div');
             buttonsEl.style.cssText = 'display: flex; gap: 10px; justify-content: flex-end;';
             
             buttons.forEach(button => {
                 const btn = document.createElement('button');
                 btn.textContent = button.text;
                 btn.style.cssText = `
                     padding: 8px 16px;
                     border: none;
                     border-radius: 6px;
                     cursor: pointer;
                     ${button.action === 'submit' ? 'background: #007bff; color: white;' : 'background: #f8f9fa; color: #333;'}
                 `;
                 
                 btn.onclick = function() {
                     if (button.action === 'cancel') {
                         closeCustomDialog();
                     } else if (button.action === 'submit' && dialog.onsubmit) {
                         dialog.onsubmit();
                     }
                 };
                 
                 buttonsEl.appendChild(btn);
             });
             
             dialog.appendChild(titleEl);
             dialog.appendChild(contentEl);
             dialog.appendChild(buttonsEl);
             overlay.appendChild(dialog);
             document.body.appendChild(overlay);
             
             // Close on overlay click
             overlay.onclick = function(e) {
                 if (e.target === overlay) {
                     closeCustomDialog();
                 }
             };
             
             return dialog;
         }
         
         function closeCustomDialog() {
             const overlay = document.getElementById('custom-dialog-overlay');
             if (overlay) {
                 document.body.removeChild(overlay);
             }
         }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Apply saved theme
            switchTheme(currentTheme);
            
            // Apply saved language
            switchLanguage(currentLanguage);
            
            // Initialize volume control
            initializeVolumeControl();
            
            // Initialize translation settings
            initializeTranslationSettings();
            
            // Load saved toggle states
            document.querySelectorAll('.toggle-switch input').forEach(toggle => {
                const flexContainer = toggle.closest('.flex');
                const pElement = flexContainer ? flexContainer.querySelector('p') : null;
                if (pElement && pElement.textContent) {
                    const setting = pElement.textContent;
                    const saved = localStorage.getItem(setting);
                    if (saved !== null) {
                        toggle.checked = saved === 'true';
                    }
                }
            });
        });
        
        // تسجيل Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(registration => {
                        console.log('Service Worker registered successfully:', registration.scope);
                    })
                    .catch(error => {
                        console.log('Service Worker registration failed:', error);
                    });
            });
        }
    </script>
</body>
</html>